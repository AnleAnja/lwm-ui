<button (click)="toggleLock()">TOGGLE LOCK</button>

<mat-horizontal-stepper labelPosition="bottom" #stepper [linear]=true>
    <mat-step *ngFor="let step of steps" [label]="label(step)" [completed]="isStepCompleted(step)">
        <ng-container [ngSwitch]="step">

            <!-- assignment plan -->
            <ng-container *ngIf="labwork && assignmentPlan">
                <ng-container *ngSwitchCase="0">
                    <ng-container *ngIf="isStepLocked(step); then thenBlock else elseBlock"></ng-container>
                    <ng-template #thenBlock>
                        <lwm-assignment-plan
                                [labwork]="labwork"
                                [plan]="assignmentPlan">
                        </lwm-assignment-plan>
                    </ng-template>
                    <ng-template #elseBlock>
                        <lwm-assignment-plan-edit
                                [labwork]="labwork"
                                [plan]="assignmentPlan"
                                (planUpdate)="updateAssignmentPlan($event)">
                        </lwm-assignment-plan-edit>
                    </ng-template>
                </ng-container>
            </ng-container>

            <!-- timetable -->
            <ng-container *ngIf="labwork && timetable">
                <ng-container *ngSwitchCase="1">
                    <ng-container *ngIf="isStepLocked(step); then thenBlock else elseBlock"></ng-container>
                    <ng-template #thenBlock>
                        <lwm-timetable-view
                                [labwork]="labwork"
                                [timetable]="timetable">
                        </lwm-timetable-view>
                    </ng-template>
                    <ng-template #elseBlock>
                        <lwm-timetable-edit
                                [labwork]="labwork"
                                [timetable]="timetable"
                                (timetableUpdate)="updateTimetable($event)">
                        </lwm-timetable-edit>
                    </ng-template>
                </ng-container>
            </ng-container>

            <!-- timetable blacklist -->
            <ng-container *ngIf="labwork && timetable">
                <ng-container *ngSwitchCase="2">
                    <ng-container *ngIf="isStepLocked(step); then thenBlock else elseBlock"></ng-container>
                    <ng-template #thenBlock>
                        <lwm-timetable-blacklist-view
                                [labwork]="labwork"
                                [timetable]="timetable">
                        </lwm-timetable-blacklist-view>
                    </ng-template>
                    <ng-template #elseBlock>
                        <lwm-timetable-blacklists-edit
                                [labwork]="labwork"
                                [timetable]="timetable"
                                (timetableUpdate)="updateTimetable($event)">
                        </lwm-timetable-blacklists-edit>
                    </ng-template>
                </ng-container>
            </ng-container>

            <!-- group -->
            <ng-container *ngIf="labwork && timetable && scheduleEntries">
                <ng-container *ngSwitchCase="3">
                    <ng-container [ngSwitch]="groupViewMode()">
                        <lwm-abstract-header *ngSwitchCase="waitingForApplications()"
                                             headerTitle="Keine Anmeldungen vorhanden">
                        </lwm-abstract-header>

                        <lwm-group-preview *ngSwitchCase="waitingForPreview()"
                                           [labwork]="labwork"
                                           [applications]="applications"
                                           (schedulePreviewEmitter)="updateSchedulePreview($event)">
                        </lwm-group-preview>

                        <lwm-group-immutable *ngSwitchCase="groupsPresent()"
                                             [labwork]="labwork"
                                             [scheduleEntries]="scheduleEntries">
                        </lwm-group-immutable>
                    </ng-container>
                </ng-container>
            </ng-container>

            <!-- schedule -->
            <ng-container *ngIf="labwork && timetable && scheduleEntries">
                <ng-container *ngSwitchCase="4">
                    <ng-container *ngIf="isStepLocked(step); then thenBlock else elseBlock"></ng-container>
                    <ng-template #thenBlock>
                        <lwm-schedule
                                [labwork]="labwork"
                                [timetable]="timetable"
                                [scheduleEntries]="scheduleEntries">
                        </lwm-schedule>
                    </ng-template>
                    <ng-template #elseBlock>
                        <lwm-schedule-preview *ngIf="schedulePreview"
                                [labwork]="labwork"
                                [timetable]="timetable"
                                [entries]="schedulePreview.schedule.entries">
                        </lwm-schedule-preview>
                    </ng-template>
                </ng-container>
            </ng-container>

            <!-- report-cards -->
            <ng-container *ngIf="labwork && timetable && scheduleEntries">
                <ng-container *ngSwitchCase="5">
                    <ng-container *ngIf="isStepLocked(step); then thenBlock else elseBlock"></ng-container>
                    <ng-template #thenBlock>
                        <lwm-closing
                                [labwork]="labwork"
                                [reportCards]="reportCards"
                                (labworkUpdate)="updateLabwork($event)">
                        </lwm-closing>
                    </ng-template>
                    <ng-template #elseBlock>
                        <lwm-report-cards
                                [labwork]="labwork"
                                [reportCards]="reportCards"
                                (labworkUpdate)="updateLabwork($event)">
                        </lwm-report-cards>
                    </ng-template>
                </ng-container>
            </ng-container>

            <p *ngSwitchDefault>???</p>
        </ng-container>

        <div>
            <button *ngIf="hasPrevButton(step)"
                    mat-button
                    matStepperPrevious>
                prev: {{prevButtonLabel(step)}}
            </button>
            <button *ngIf="hasNextButton(step) && isStepCompleted(step)"
                    mat-button
                    matStepperNext>
                next: {{nextButtonLabel(step)}}
            </button>
        </div>
    </mat-step>
</mat-horizontal-stepper>

